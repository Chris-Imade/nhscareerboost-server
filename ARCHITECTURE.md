# System Architecture

Visual guide to understanding how the NHS Career Boost Mail Server works.

---

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NHS Career Boost Website                     â”‚
â”‚                  (https://nhscareerboost.co.uk)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTPS Requests
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚                   NHS Career Boost Mail Server                   â”‚
â”‚                         (This Project)                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Security Layer                        â”‚   â”‚
â”‚  â”‚  â€¢ CORS Protection                                       â”‚   â”‚
â”‚  â”‚  â€¢ Rate Limiting                                         â”‚   â”‚
â”‚  â”‚  â€¢ Helmet Security Headers                              â”‚   â”‚
â”‚  â”‚  â€¢ Input Validation                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Express.js Router                         â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚  /api/contact          /api/payment/webhook            â”‚     â”‚
â”‚  â”‚       â”‚                        â”‚                        â”‚     â”‚
â”‚  â”‚       â–¼                        â–¼                        â”‚     â”‚
â”‚  â”‚  contact.js              payment.js                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Email Template Engine                     â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚  â€¢ contactTemplate.js                                  â”‚     â”‚
â”‚  â”‚  â€¢ paymentSuccessTemplate.js                           â”‚     â”‚
â”‚  â”‚  â€¢ paymentFailureTemplate.js                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ SMTP
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gmail SMTP   â”‚                         â”‚    Stripe    â”‚
â”‚   Server      â”‚                         â”‚   Webhooks   â”‚
â”‚               â”‚                         â”‚              â”‚
â”‚ Sends emails  â”‚                         â”‚ Payment      â”‚
â”‚ to clients    â”‚                         â”‚ events       â”‚
â”‚ and admin     â”‚                         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¨ Contact Form Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Website    â”‚
â”‚  User fills  â”‚
â”‚ contact form â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/contact
       â”‚ {name, email, service, message}
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Mail Server - contact.js         â”‚
â”‚                                       â”‚
â”‚  1. CORS Check                        â”‚
â”‚     âœ“ Origin allowed?                 â”‚
â”‚                                       â”‚
â”‚  2. Rate Limit Check                  â”‚
â”‚     âœ“ Under 5 requests/15min?         â”‚
â”‚                                       â”‚
â”‚  3. Input Validation                  â”‚
â”‚     âœ“ Name valid?                     â”‚
â”‚     âœ“ Email valid?                    â”‚
â”‚     âœ“ Service selected?               â”‚
â”‚                                       â”‚
â”‚  4. Generate Emails                   â”‚
â”‚     â€¢ Client confirmation             â”‚
â”‚     â€¢ Admin notification              â”‚
â”‚     â€¢ Admin copy                      â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SMTP Connection
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Gmail SMTP Server            â”‚
â”‚                                       â”‚
â”‚  Sends 3 emails:                      â”‚
â”‚                                       â”‚
â”‚  1. âœ‰ï¸  â†’ user@example.com           â”‚
â”‚     "Thank you for contacting us"    â”‚
â”‚                                       â”‚
â”‚  2. âœ‰ï¸  â†’ daniel@nhscareerboost.co.ukâ”‚
â”‚     "New contact: [details]"         â”‚
â”‚                                       â”‚
â”‚  3. âœ‰ï¸  â†’ daniel@nhscareerboost.co.ukâ”‚
â”‚     "[Copy] Thank you..."            â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Success Response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Website                     â”‚
â”‚  Shows: "Thank you! We'll be in      â”‚
â”‚          touch soon."                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Timeline:** ~2-3 seconds total

---

## ğŸ’³ Payment Success Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚
â”‚ Completes    â”‚
â”‚  payment     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Payment processed
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Stripe Platform             â”‚
â”‚                                       â”‚
â”‚  Payment successful!                  â”‚
â”‚  Triggers: payment_intent.succeeded  â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/payment/webhook
       â”‚ + Stripe-Signature header
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Mail Server - payment.js          â”‚
â”‚                                       â”‚
â”‚  1. Verify Webhook Signature          â”‚
â”‚     âœ“ Authentic Stripe request?       â”‚
â”‚                                       â”‚
â”‚  2. Parse Payment Data                â”‚
â”‚     â€¢ Amount                          â”‚
â”‚     â€¢ Customer email                  â”‚
â”‚     â€¢ Transaction ID                  â”‚
â”‚                                       â”‚
â”‚  3. Generate Emails                   â”‚
â”‚     â€¢ Client receipt                  â”‚
â”‚     â€¢ Admin notification              â”‚
â”‚     â€¢ Admin copy                      â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SMTP Connection
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Gmail SMTP Server            â”‚
â”‚                                       â”‚
â”‚  Sends 3 emails:                      â”‚
â”‚                                       â”‚
â”‚  1. âœ‰ï¸  â†’ customer@example.com       â”‚
â”‚     "Payment Confirmation - Â£50.00"  â”‚
â”‚                                       â”‚
â”‚  2. âœ‰ï¸  â†’ daniel@nhscareerboost.co.ukâ”‚
â”‚     "ğŸ’° Payment Received - Â£50.00"   â”‚
â”‚                                       â”‚
â”‚  3. âœ‰ï¸  â†’ daniel@nhscareerboost.co.ukâ”‚
â”‚     "[Copy] Payment Confirmation..." â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 200 OK
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Stripe Platform             â”‚
â”‚  Webhook delivered successfully âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Timeline:** ~1-2 seconds total

---

## ğŸš¨ Payment Failure Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚
â”‚ Payment      â”‚
â”‚  fails       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Payment declined
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Stripe Platform             â”‚
â”‚                                       â”‚
â”‚  Payment failed!                      â”‚
â”‚  Triggers: payment_intent.            â”‚
â”‚            payment_failed             â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST /api/payment/webhook
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Mail Server - payment.js          â”‚
â”‚                                       â”‚
â”‚  1. Verify Signature                  â”‚
â”‚  2. Parse Error Details               â”‚
â”‚  3. Generate Admin Alert              â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ SMTP
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Gmail SMTP Server            â”‚
â”‚                                       â”‚
â”‚  Sends 1 email:                       â”‚
â”‚                                       â”‚
â”‚  âœ‰ï¸  â†’ daniel@nhscareerboost.co.uk   â”‚
â”‚     "âš ï¸ Payment Failed"               â”‚
â”‚     [Error details & action items]   â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Note:** Customer is NOT emailed (Stripe handles that)

---

## ğŸ”’ Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Incoming Request                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Layer 1:     â”‚
                  â”‚ CORS Check   â”‚
                  â”‚              â”‚
                  â”‚ âœ“ Origin in  â”‚
                  â”‚   whitelist? â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ“ Pass
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Layer 2:     â”‚
                  â”‚ Rate Limit   â”‚
                  â”‚              â”‚
                  â”‚ âœ“ Under max  â”‚
                  â”‚   requests?  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ“ Pass
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Layer 3:     â”‚
                  â”‚ Helmet       â”‚
                  â”‚              â”‚
                  â”‚ âœ“ Security   â”‚
                  â”‚   headers    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ“ Pass
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Layer 4:     â”‚
                  â”‚ Validation   â”‚
                  â”‚              â”‚
                  â”‚ âœ“ Input      â”‚
                  â”‚   sanitized  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ“ Pass
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Layer 5:     â”‚
                  â”‚ Webhook      â”‚
                  â”‚ Signature    â”‚
                  â”‚ (if webhook) â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ âœ“ Pass
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Process Request   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ File Relationships

```
index.js (Main Server)
    â”‚
    â”œâ”€â”€â”€ Imports â”€â”€â†’ routes/contact.js
    â”‚                    â”‚
    â”‚                    â””â”€â”€â”€ Uses â”€â”€â†’ emails/contactTemplate.js
    â”‚
    â”œâ”€â”€â”€ Imports â”€â”€â†’ routes/payment.js
    â”‚                    â”‚
    â”‚                    â”œâ”€â”€â”€ Uses â”€â”€â†’ emails/paymentSuccessTemplate.js
    â”‚                    â”‚
    â”‚                    â””â”€â”€â”€ Uses â”€â”€â†’ emails/paymentFailureTemplate.js
    â”‚
    â”œâ”€â”€â”€ Loads â”€â”€â”€â”€â†’ .env (Environment Variables)
    â”‚
    â””â”€â”€â”€ Defines â”€â”€â†’ Middleware (CORS, Rate Limiting, Helmet)
```

---

## ğŸ”„ Data Flow - Contact Form

```
Frontend Form Data
        â”‚
        â”‚ {name, email, phone, service, message}
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Input Validator  â”‚
â”‚                   â”‚
â”‚  â€¢ Trim spaces    â”‚
â”‚  â€¢ Check email    â”‚
â”‚  â€¢ Check length   â”‚
â”‚  â€¢ Sanitize HTML  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Validated Data
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Email Generator   â”‚
â”‚                   â”‚
â”‚ Creates 3 emails  â”‚
â”‚ with HTML + text  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Email Objects
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nodemailer SMTP   â”‚
â”‚                   â”‚
â”‚ Connects to Gmail â”‚
â”‚ Sends all 3       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Success/Failure
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response to User  â”‚
â”‚                   â”‚
â”‚ {success: true}   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Network Architecture

```
                    Internet
                       â”‚
                       â”‚ HTTPS
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend    â”‚            â”‚  Mail Server   â”‚
â”‚               â”‚            â”‚                â”‚
â”‚ Port: 443     â”‚            â”‚ Port: 3000     â”‚
â”‚ (HTTPS)       â”‚            â”‚ (HTTP/HTTPS)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                   â”‚
                    â–¼                                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Gmail SMTP   â”‚                  â”‚     Stripe     â”‚
            â”‚               â”‚                  â”‚                â”‚
            â”‚ Port: 587     â”‚                  â”‚ Webhooks       â”‚
            â”‚ (STARTTLS)    â”‚                  â”‚ (HTTPS)        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Storage Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NO DATABASE REQUIRED                        â”‚
â”‚                                                          â”‚
â”‚  All records maintained through email copies:           â”‚
â”‚                                                          â”‚
â”‚  Contact Form Submission                                â”‚
â”‚  â”œâ”€ Client receives confirmation                        â”‚
â”‚  â”œâ”€ Admin receives detailed record                      â”‚
â”‚  â””â”€ Admin receives copy of confirmation                 â”‚
â”‚                                                          â”‚
â”‚  Payment Success                                        â”‚
â”‚  â”œâ”€ Customer receives receipt                           â”‚
â”‚  â”œâ”€ Admin receives payment record                       â”‚
â”‚  â””â”€ Admin receives copy of receipt                      â”‚
â”‚                                                          â”‚
â”‚  Payment Failure                                        â”‚
â”‚  â””â”€ Admin receives failure alert                        â”‚
â”‚                                                          â”‚
â”‚  Benefits:                                              â”‚
â”‚  âœ“ No database to maintain                              â”‚
â”‚  âœ“ No backup strategy needed                            â”‚
â”‚  âœ“ Email provides permanent record                      â”‚
â”‚  âœ“ Searchable in email client                           â”‚
â”‚  âœ“ Automatic archiving                                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Environment Configuration Flow

```
.env file
    â”‚
    â”‚ Loaded by dotenv
    â”‚
    â–¼
process.env
    â”‚
    â”œâ”€â”€â”€ SMTP_* â”€â”€â”€â”€â”€â”€â”€â”€â†’ Nodemailer Config
    â”‚
    â”œâ”€â”€â”€ STRIPE_* â”€â”€â”€â”€â”€â”€â†’ Stripe SDK Config
    â”‚
    â”œâ”€â”€â”€ ADMIN_EMAIL â”€â”€â”€â†’ Email Recipients
    â”‚
    â”œâ”€â”€â”€ ALLOWED_ORIGINS â†’ CORS Config
    â”‚
    â””â”€â”€â”€ PORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Express Server Port
```

---

## ğŸ“Š Request/Response Lifecycle

### Contact Form Request

```
1. Request arrives     [0ms]
   â†“
2. CORS check         [1ms]
   â†“
3. Rate limit check   [2ms]
   â†“
4. Parse JSON body    [5ms]
   â†“
5. Validate input     [10ms]
   â†“
6. Connect to SMTP    [200ms]
   â†“
7. Send email 1       [500ms]
   â†“
8. Send email 2       [500ms]
   â†“
9. Send email 3       [500ms]
   â†“
10. Return response   [1800ms]

Total: ~2 seconds
```

### Webhook Request

```
1. Request arrives     [0ms]
   â†“
2. Verify signature   [5ms]
   â†“
3. Parse event        [10ms]
   â†“
4. Route to handler   [15ms]
   â†“
5. Connect to SMTP    [200ms]
   â†“
6. Send emails        [500-1500ms]
   â†“
7. Return 200 OK      [1000-2000ms]

Total: ~1-2 seconds
```

---

## ğŸ¯ Component Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ index.js                                                 â”‚
â”‚ â€¢ Server initialization                                  â”‚
â”‚ â€¢ Middleware configuration                               â”‚
â”‚ â€¢ Route registration                                     â”‚
â”‚ â€¢ Error handling                                         â”‚
â”‚ â€¢ Environment validation                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ routes/contact.js                                        â”‚
â”‚ â€¢ Input validation                                       â”‚
â”‚ â€¢ Form data processing                                   â”‚
â”‚ â€¢ Email orchestration                                    â”‚
â”‚ â€¢ Error responses                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ routes/payment.js                                        â”‚
â”‚ â€¢ Webhook signature verification                         â”‚
â”‚ â€¢ Event routing                                          â”‚
â”‚ â€¢ Payment data extraction                                â”‚
â”‚ â€¢ Email orchestration                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ emails/*.js                                              â”‚
â”‚ â€¢ HTML template generation                               â”‚
â”‚ â€¢ Plain text generation                                  â”‚
â”‚ â€¢ Data formatting                                        â”‚
â”‚ â€¢ Subject line creation                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Production Setup                       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   GitHub   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Railway/    â”‚               â”‚
â”‚  â”‚ Repository â”‚  Push   â”‚  Render/     â”‚               â”‚
â”‚  â”‚            â”‚         â”‚  Heroku      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                â”‚                         â”‚
â”‚                                â”‚ Auto Deploy             â”‚
â”‚                                â”‚                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                         â”‚ Mail Server  â”‚                â”‚
â”‚                         â”‚ (Running)    â”‚                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                â”‚                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚              â”‚                                   â”‚      â”‚
â”‚              â–¼                                   â–¼      â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚      â”‚ Environment  â”‚                   â”‚  Logs    â”‚   â”‚
â”‚      â”‚  Variables   â”‚                   â”‚ (stdout) â”‚   â”‚
â”‚      â”‚ (Platform)   â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This architecture ensures:**
- âœ… High reliability
- âœ… Easy maintenance
- âœ… Clear separation of concerns
- âœ… Scalable design
- âœ… Security by default
